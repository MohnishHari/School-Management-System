package com.app.registration.controller;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import com.app.registration.model.Staff;
import com.app.registration.model.Student;
import com.app.registration.repository.StaffRepository;
import com.app.registration.service.ResourceNotFoundException;
import com.app.registration.service.ResourceNotFoundException3;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api")
public class StaffController {

    @Autowired
    private StaffRepository staffRepository;

    @GetMapping("/staffs")
    @CrossOrigin(origins = "http://localhost:4200")
    public List<Staff> getAllStaffs(){
        return this.staffRepository.findAll();
    }

    @GetMapping("/staffs/{id}")
    @CrossOrigin(origins = "http://localhost:4200")
    public ResponseEntity<Staff> getStaffById(@PathVariable Long id){
    	Staff staff = staffRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException3("Staff with id '"+id+"' does not exist"));
        return ResponseEntity.ok(staff);
    }

    @PostMapping("/staffs")
    @CrossOrigin(origins = "http://localhost:4200")
    public Staff createStaff(@RequestBody Staff staff){
        return staffRepository.save(staff);
    }
    @PutMapping("/staffs/{id}")
    public ResponseEntity<Staff> updateStaff (@PathVariable Long id, @RequestBody Staff staffInfo) {

        Staff staff = staffRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Staff with id '" + id + "' does not exist"));

        student.setAddress(studentInfo.getAddress());
        student.setName(studentInfo.getName());
        student.setClassNo(studentInfo.getClassNo());
        student.setRollNo(studentInfo.getRollNo());
        student.setDob(studentInfo.getDob());
        student.setAddress(studentInfo.getAddress());
        student.setFather(studentInfo.getFather());
        student.setMother(studentInfo.getMother());

        
        Staff updatedStaff = staffRepository.save(staff);
        return ResponseEntity.ok(updatedStaff);
    }

    // todo: validate
    @DeleteMapping("/staffs/{id}")
    @CrossOrigin(origins = "http://localhost:4200")
    public ResponseEntity<Map<String, Boolean>> deleteStaff(@PathVariable Long id){
    	Staff staff = staffRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException3("Staff with id '" + id + "' does not exist"));

        staffRepository.delete(staff);
        Map<String, Boolean> response = new HashMap<>();

        response.put("deleted",Boolean.TRUE);
        return ResponseEntity.ok(response);

    }

}